{"version":3,"file":"uuz.js","sources":["../src/index.js"],"sourcesContent":["let targetMap = new WeakMap();\r\nlet activeEffect;\r\n\r\nexport function mount(instance, el) {\r\n  effect(function() {\r\n    instance.$data && update(el, instance);\r\n  })\r\n  instance.$data = instance.setup();\r\n  update(el, instance);\r\n}\r\n\r\nfunction update(el, instance) {\r\n  el.innerHTML = instance.render()\r\n}\r\n\r\nfunction effect(fn) {\r\n  const _effect = function(...args) {\r\n    activeEffect = _effect;\r\n    return fn(...args);\r\n  };\r\n  _effect();\r\n  return _effect;\r\n}\r\n\r\nexport function reactive(target) {\r\n  return new Proxy(target, {\r\n    get(target, prop) {\r\n      track(target, prop);\r\n      return Reflect.get(target, prop);\r\n    },\r\n    set(target, prop, newVal) {\r\n      Reflect.set(target, prop, newVal);\r\n      trigger(target, prop);\r\n      // 必须 return true;\r\n      // 否则会产生警告 'set' on proxy: trap returned falsish for property \r\n      return true;\r\n    }\r\n  })\r\n}\r\n\r\nfunction track(target, key) {\r\n  let depsMap = targetMap.get(target);\r\n  if (!depsMap) {\r\n\t\ttargetMap.set(target, (depsMap = new Map()));\r\n  }\r\n  let dep = depsMap.get(key);\r\n\tif (!dep) {\r\n    depsMap.set(key, (dep = new Set()));\r\n  }\r\n  if (!dep.has(activeEffect)) {\r\n\t\tdep.add(activeEffect);\r\n\t}\r\n}\r\n\r\nfunction trigger(target, key) {\r\n  const depsMap = targetMap.get(target);\r\n  if (!depsMap) return;\r\n  const effects = new Set()\r\n  depsMap.get(key).forEach(e => effects.add(e))\r\n  effects.forEach(e => e())\r\n}"],"names":["activeEffect","targetMap","WeakMap","update","el","instance","innerHTML","render","fn","_effect","args","effect","$data","setup","target","Proxy","get","prop","key","depsMap","set","Map","dep","Set","has","add","track","Reflect","newVal","effects","forEach","e","trigger"],"mappings":"iMAAA,IACIA,EADAC,EAAY,IAAIC,QAWpB,SAASC,EAAOC,EAAIC,GAClBD,EAAGE,UAAYD,EAASE,iBATnB,SAAeF,EAAUD,IAYhC,SAAgBI,SACRC,EAAU,YAAYC,UAC1BV,EAAeS,EACRD,KAAME,IAEfD,IAhBAE,EAAO,WACLN,EAASO,OAAST,EAAOC,EAAIC,MAE/BA,EAASO,MAAQP,EAASQ,QAC1BV,EAAOC,EAAIC,eAgBN,SAAkBS,UAChB,IAAIC,MAAMD,EAAQ,CACvBE,IAAG,CAACF,EAAQG,KAchB,SAAeH,EAAQI,OACjBC,EAAUlB,EAAUe,IAAIF,GACvBK,GACLlB,EAAUmB,IAAIN,EAASK,EAAU,IAAIE,SAEjCC,EAAMH,EAAQH,IAAIE,GAClBI,GACFH,EAAQC,IAAIF,EAAMI,EAAM,IAAIC,KAEzBD,EAAIE,IAAIxB,IACbsB,EAAIG,IAAIzB,GAvBJ0B,CAAMZ,EAAQG,GACPU,QAAQX,IAAIF,EAAQG,IAE7BG,IAAG,CAACN,EAAQG,EAAMW,KAChBD,QAAQP,IAAIN,EAAQG,EAAMW,GAuBhC,SAAiBd,EAAQI,SACjBC,EAAUlB,EAAUe,IAAIF,OACzBK,EAAS,aACRU,EAAU,IAAIN,IACpBJ,EAAQH,IAAIE,GAAKY,QAAQC,GAAKF,EAAQJ,IAAIM,IAC1CF,EAAQC,QAAQC,GAAKA,KA3BjBC,CAAQlB,EAAQG,IAGT"}