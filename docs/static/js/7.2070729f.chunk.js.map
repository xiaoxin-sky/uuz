{"version":3,"sources":["controller/trickle.ts","views/Trickle.tsx","site/pages/trickle/index.js","../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js"],"names":["TrickleControl","data","colData","col","curIdx","this","num","slice","map","val","length","elements","heightList","ele","offsetTop","miniHeight","Math","min","indexOf","targetIdx","_findLowCol","addCurIdx","push","Trickle","childRender","refFlag","len","initColData","Array","fill","useState","setCol","waterfallControl","setData","dataManager","setCurIdx","useEffect","setFirstRowData","getColData","pushDataToLowCol","dataIdx","getCurIdx","imgReady","url","className","idx","key","style","width","sub","subIdx","src","txt","ref","name","desc","SubBody","props","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","i","descriptor","enumerable","configurable","writable","Object","defineProperty","_createClass","protoProps","staticProps","prototype","_toConsumableArray","arr","isArray","arr2","iter","Symbol","iterator","toString","call","from"],"mappings":"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","file":"static/js/7.2070729f.chunk.js","sourcesContent":["\nclass TrickleControl {\n\n    data: Array<any>;\n    // len: number;\n    colData: Array<Array<any>>;\n    col: number;\n    curIdx: number;\n\n    constructor() {\n        this.data = [];\n        // this.len = 0;\n        this.colData = [];\n        this.col = 0;\n        this.curIdx = 0;\n    }\n\n    getColData() {\n        return this.colData;\n    }\n\n    getCurIdx(): number {\n        return this.curIdx;\n    }\n\n    setCol(col: number) {\n        this.col = col;\n    }\n\n    setData(data: Array<any>) {\n        this.data = data;\n        // this.len = data.length;\n    }\n    \n    addCurIdx(num = 1) {\n        this.curIdx += num; \n    }\n\n    setFirstRowData() {\n        this.colData = this.data.slice(0, this.col).map(val => [val]);\n        if (this.colData.length) {\n            this.curIdx = this.colData.length - 1;\n        }\n    }\n\n    _findLowCol(elements: Array<HTMLDivElement>) {\n        const heightList = elements.map(ele => ele.offsetTop);\n        const miniHeight = Math.min(...heightList);\n        const targetIdx = heightList.indexOf(miniHeight);\n        return targetIdx;\n    }\n\n    pushDataToLowCol(elements: Array<HTMLDivElement>) {\n        const targetIdx = this._findLowCol(elements);\n        this.addCurIdx();\n        this.colData[targetIdx].push(this.data[this.curIdx]);\n    }\n}\n\nexport default TrickleControl;","import React, { useState, useEffect } from 'react';\n\nimport { imgReady } from '../utils/base';\nimport TrickleControl from '../controller/trickle';\n\ninterface TrickleProps {\n    data: Array<any>,\n    col: number,\n    childRender: any\n}\n/* \n    瀑布流：图片需要从cdn下载，所以不能实时获取到图片宽高\n\n    已知获取图片宽高的方法\n    1. 限制图片宽高\n    2. 已知图片宽高\n    3. 等待图片加载获取宽高\n*/\nfunction Trickle({ data, col = 2, childRender }: TrickleProps) {\n\n    let refFlag: Array<HTMLDivElement | any> = [];\n    \n    const len = data.length;\n    const initColData = Array(col).fill('col').map(() => []) as Array<Array<any>>;\n    const [colData, setCol] = useState(initColData);\n\n    const waterfallControl = new TrickleControl();\n    waterfallControl.setData(data);\n    waterfallControl.setCol(col);\n    \n    const [dataManager] = useState(waterfallControl);\n    const [curIdx, setCurIdx] = useState(0);\n\n    useEffect(() => {\n        if (curIdx < len - 1) {\n            if (curIdx < col - 1) {\n                dataManager.setFirstRowData()\n                setCol(dataManager.getColData());\n            } else {\n                dataManager.pushDataToLowCol(refFlag);\n                setCol(dataManager.getColData());\n            }\n            const dataIdx = dataManager.getCurIdx();\n            imgReady(data[dataIdx].url, () => {\n                setCurIdx(dataIdx);\n            })\n        }\n    }, [curIdx])\n\n    return <div className=\"zui-waterfall zui-clearfix\">\n        {\n            colData.map((val, idx) => <div key={idx}\n                className=\"zui-waterfall-col\"\n                style={{\n                    width: 100/col + '%'\n                }}>\n                {\n                    val.map((sub, subIdx) => <div key={`${idx}-${subIdx}`}\n                        className=\"zui-waterfall-item\">\n                        <img\n                            className=\"zui-waterfall-img\"\n                            src={sub.url}\n                        />\n                        {/* 子模块可以自定义 */}\n                        { \n                            typeof childRender === 'function' ?\n                                childRender(sub) :\n                                <div>{sub.txt}</div>\n                        }\n                    </div>)\n                }\n                <div ref={ele => refFlag[idx] = ele}></div>\n            </div>)\n        }\n    </div>\n}\n\nexport default Trickle;\n","import React from 'react';\nimport Waterfall from '../../../views/Trickle'\n\nconst data = Array(21).fill('data').map((val, idx) => {\n    return {\n        url: `https://zhongmeizhi.github.io/static/test/${20-idx}.jpg`,\n        name: `瀑布流`,\n        desc: `${idx}`\n    }\n})\n\n\nfunction SubBody(props) {\n    return <div>\n        <p className=\"zui-waterfall-txt\">{props.name}</p>\n        <p className=\"zui-waterfall-txt\">{props.desc}</p>\n    </div>\n}\n\nexport default () => {\n    return <div>\n        <Waterfall data={data} col={3} childRender={SubBody}></Waterfall>\n    </div>\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}","export default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}","export default function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}"],"sourceRoot":""}