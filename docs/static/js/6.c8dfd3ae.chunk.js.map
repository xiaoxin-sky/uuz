{"version":3,"sources":["controller/waterfall.ts","views/Waterfall.tsx","site/pages/waterfall/index.js","site/pages/waterfall/data.js","../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js"],"names":["WaterfallControl","data","colData","col","curIdx","colWidth","this","width","num","elements","heightList","map","ele","offsetTop","miniHeight","Math","min","indexOf","height","rate","targetIdx","_findLowCol","addCurIdx","slice","val","target","size","_formatSize","push","Waterfall","childRender","refFlag","len","length","initColData","Array","fill","useState","setCol","waterfallControl","setData","dataManager","setCurIdx","useEffect","offsetWidth","setColWidth","pushDataToLowCol","getColData","getCurIdx","className","idx","key","style","sub","subIdx","src","url","txt","ref","SubBody","props","formatData","sizeReg","match","Number","getSize","Object","assign","_classCallCheck","instance","Constructor","TypeError","_defineProperties","i","descriptor","enumerable","configurable","writable","defineProperty","_createClass","protoProps","staticProps","prototype","_toConsumableArray","arr","isArray","arr2","iter","Symbol","iterator","toString","call","from"],"mappings":"qKAyEeA,E,WA/DX,aAAe,yBAPfC,UAOc,OALdC,aAKc,OAJdC,SAIc,OAHdC,YAGc,OAFdC,cAEc,EACVC,KAAKL,KAAO,GAEZK,KAAKJ,QAAU,GACfI,KAAKH,IAAM,EACXG,KAAKF,OAAS,EACdE,KAAKD,SAAW,E,yDAIhB,OAAOC,KAAKJ,U,kCAIZ,OAAOI,KAAKF,S,kCAGJG,GACRD,KAAKD,SAAWE,I,6BAGbJ,GACHG,KAAKH,IAAMA,I,8BAGPF,GACJK,KAAKL,KAAOA,I,kCAII,IAAVO,EAAS,uDAAH,EACZF,KAAKF,QAAUI,I,kCAGPC,GACR,IAAMC,EAAaD,EAASE,KAAI,SAAAC,GAAG,OAAIA,EAAIC,aACrCC,EAAaC,KAAKC,IAAL,MAAAD,KAAI,YAAQL,IAE/B,OADkBA,EAAWO,QAAQH,K,kCAI7BP,EAAeW,GACvB,IAAMC,EAAOb,KAAKD,SAAWE,EAC7B,MAAO,CACHA,MAAOD,KAAKD,SACZa,OAAQA,EAASC,K,uCAIRV,GACb,IAAMW,EAAYd,KAAKe,YAAYZ,GACnCH,KAAKgB,YACAhB,KAAKJ,QAAQkB,KACdd,KAAKJ,QAAUI,KAAKL,KAAKsB,MAAM,EAAGjB,KAAKH,KAAKQ,KAAI,SAAAa,GAAG,MAAI,OAE3D,IAAIC,EAASnB,KAAKL,KAAKK,KAAKF,QACtBsB,EAAOpB,KAAKqB,YAAYF,EAAOlB,MAAOkB,EAAOP,QACnDO,EAAOlB,MAAQmB,EAAKnB,MACpBkB,EAAOP,OAASQ,EAAKR,OACrBZ,KAAKJ,QAAQkB,GAAWQ,KAAKH,O,KCUtBI,MA7Df,YAAmE,IAA9C5B,EAA6C,EAA7CA,KAA6C,IAAvCE,WAAuC,MAAjC,EAAiC,EAA9B2B,EAA8B,EAA9BA,YAE5BC,EAAuC,GAErCC,EAAM/B,EAAKgC,OACXC,EAAcC,MAAMhC,GAAKiC,KAAK,OAAOzB,KAAI,iBAAM,MALS,EAMpC0B,mBAASH,GAN2B,mBAMvDhC,EANuD,KAM9CoC,EAN8C,KAQxDC,EAAmB,IAAIvC,EAC7BuC,EAAiBC,QAAQvC,GACzBsC,EAAiBD,OAAOnC,GAVsC,MAYxCkC,mBAASE,GAAxBE,EAZuD,sBAalCJ,mBAAS,GAbyB,mBAavDjC,EAbuD,KAa/CsC,EAb+C,KA6B9D,OAdAC,qBAAU,WACN,IAAMtC,EAAW0B,EAAQ,GAAGa,YAE5BL,EAAiBM,YAAYxC,KAC9B,IAEHsC,qBAAU,WACFvC,EAAS4B,EAAM,IACfS,EAAYK,iBAAiBf,GAC7BO,EAAOG,EAAYM,cACnBL,EAAUD,EAAYO,gBAE3B,CAAC5C,IAEG,yBAAK6C,UAAU,8BAEd/C,EAAQS,KAAI,SAACa,EAAK0B,GAAN,OAAc,yBAAKC,IAAKD,EAChCD,UAAU,oBACVG,MAAO,CACH7C,MAAO,IAAIJ,EAAM,MAGjBqB,EAAIb,KAAI,SAAC0C,EAAKC,GAAN,OAAiB,yBAAKH,IAAG,UAAKD,EAAL,YAAYI,GACzCL,UAAU,sBACV,yBACIG,MAAO,CACH7C,MAAO8C,EAAI9C,MAAQ,KACnBW,OAAQmC,EAAInC,OAAS,MAEzB+B,UAAU,oBACVM,IAAKF,EAAIG,MAIc,oBAAhB1B,EACHA,EAAYuB,GACZ,6BAAMA,EAAII,SAI1B,yBAAKC,IAAK,SAAA9C,GAAG,OAAImB,EAAQmB,GAAOtC,W,QCnEhD,SAAS+C,EAAQC,GACb,OAAO,6BACH,uBAAGX,UAAU,qBAAqBW,EAAMH,MAIjC,qBAUX,IAAMI,EAAa5D,UAAKU,KAAI,SAAAa,GACxB,IAAME,EATV,SAAiB8B,GACb,IAAMM,EAAUN,EAAIO,MAAM,2BAC1B,MAAO,CACHxD,MAAOyD,OAAOF,EAAQ,IACtB5C,OAAQ8C,OAAOF,EAAQ,KAKdG,CAAQzC,EAAIgC,KACzB,OAAOU,OAAOC,OAAO,GAAI3C,EAAKE,MAGlC,OAAO,6BACH,kBAAC,EAAD,CAAWzB,KAAM4D,EAAY1D,IAAK,EAAG2B,YAAa6B,O,gCC5B1D,OAAe,WACX,CACIH,IAAI,6DACJC,IAAI,wCACL,CACCD,IAAI,8DACJC,IAAI,4EACL,CACCD,IAAI,8DACJC,IAAI,gHACL,CACCD,IAAI,8DACJC,IAAI,IACL,CACCD,IAAI,8DACJC,IAAI,wLACL,CACCD,IAAI,8DACJC,IAAI,sBACL,CACCD,IAAI,8DACJC,IAAI,4EACL,CACCD,IAAI,8DACJC,IAAI,IACL,CACCD,IAAI,8DACJC,IAAI,sBACL,CACCD,IAAI,8DACJC,IAAI,IACL,CACCD,IAAI,8DACJC,IAAI,wLACL,CACCD,IAAI,6DACJC,IAAI,IACL,CACCD,IAAI,6DACJC,IAAI,sBACL,CACCD,IAAI,6DACJC,IAAI,oJACL,CACCD,IAAI,6DACJC,IAAI,4EACL,CACCD,IAAI,6DACJC,IAAI,IACL,CACCD,IAAI,6DACJC,IAAI,IACL,CACCD,IAAI,6DACJC,IAAI,IACL,CACCD,IAAI,6DACJC,IAAI,4EACL,CACCD,IAAI,6DACJC,IAAI,gHACL,CACCD,IAAI,6DACJC,IAAI,wB,gCC/DG,SAASW,EAAgBC,EAAUC,GAChD,KAAMD,aAAoBC,GACxB,MAAM,IAAIC,UAAU,qCAFxB,mC,gCCAA,SAASC,EAAkB/C,EAAQmC,GACjC,IAAK,IAAIa,EAAI,EAAGA,EAAIb,EAAM3B,OAAQwC,IAAK,CACrC,IAAIC,EAAad,EAAMa,GACvBC,EAAWC,WAAaD,EAAWC,aAAc,EACjDD,EAAWE,cAAe,EACtB,UAAWF,IAAYA,EAAWG,UAAW,GACjDX,OAAOY,eAAerD,EAAQiD,EAAWvB,IAAKuB,IAInC,SAASK,EAAaT,EAAaU,EAAYC,GAG5D,OAFID,GAAYR,EAAkBF,EAAYY,UAAWF,GACrDC,GAAaT,EAAkBF,EAAaW,GACzCX,EAbT,mC,gCCGe,SAASa,EAAmBC,GACzC,OCJa,SAA4BA,GACzC,GAAIjD,MAAMkD,QAAQD,GAAM,CACtB,IAAK,IAAIX,EAAI,EAAGa,EAAO,IAAInD,MAAMiD,EAAInD,QAASwC,EAAIW,EAAInD,OAAQwC,IAC5Da,EAAKb,GAAKW,EAAIX,GAGhB,OAAOa,GDFF,CAAkBF,IEJZ,SAA0BG,GACvC,GAAIC,OAAOC,YAAYvB,OAAOqB,IAAkD,uBAAzCrB,OAAOgB,UAAUQ,SAASC,KAAKJ,GAAgC,OAAOpD,MAAMyD,KAAKL,GFGvF,CAAgBH,IGJpC,WACb,MAAM,IAAIb,UAAU,mDHGqC,GAJ3D","file":"static/js/6.c8dfd3ae.chunk.js","sourcesContent":["\nclass WaterfallControl {\n\n    data: Array<any>;\n    // len: number;\n    colData: Array<Array<any>>;\n    col: number;\n    curIdx: number;\n    colWidth: number;\n\n    constructor() {\n        this.data = [];\n        // this.len = 0;\n        this.colData = [];\n        this.col = 0;\n        this.curIdx = 0;\n        this.colWidth = 0;\n    }\n\n    getColData() {\n        return this.colData;\n    }\n\n    getCurIdx(): number {\n        return this.curIdx;\n    }\n\n    setColWidth(width: number) {\n        this.colWidth = width;\n    }\n\n    setCol(col: number) {\n        this.col = col;\n    }\n\n    setData(data: Array<any>) {\n        this.data = data;\n        // this.len = data.length;\n    }\n    \n    addCurIdx(num = 1) {\n        this.curIdx += num; \n    }\n\n    _findLowCol(elements: Array<HTMLDivElement>) {\n        const heightList = elements.map(ele => ele.offsetTop);\n        const miniHeight = Math.min(...heightList);\n        const targetIdx = heightList.indexOf(miniHeight);\n        return targetIdx;\n    }\n\n    _formatSize(width: number, height: number) {\n        const rate = this.colWidth / width;\n        return {\n            width: this.colWidth,\n            height: height * rate\n        }\n    }\n\n    pushDataToLowCol(elements: Array<HTMLDivElement>) {\n        const targetIdx = this._findLowCol(elements);\n        this.addCurIdx();\n        if (!this.colData[targetIdx]) {\n            this.colData = this.data.slice(0, this.col).map(val => []);\n        }\n        let target = this.data[this.curIdx];\n        const size = this._formatSize(target.width, target.height);\n        target.width = size.width;\n        target.height = size.height;\n        this.colData[targetIdx].push(target);\n    }\n}\n\nexport default WaterfallControl;","import React, { useState, useEffect } from 'react';\nimport WaterfallControl from '../controller/waterfall';\n\ninterface WaterfallProps {\n    data: Array<any>,\n    col: number,\n    childRender: any\n}\n/* \n    瀑布流：图片需要从cdn下载，所以不能实时获取到图片宽高\n\n    已知获取图片宽高的方法\n    1. 限制图片宽高\n    2. 已知图片宽高\n    3. 等待图片加载获取宽高\n\n    \n*/\nfunction Waterfall({ data, col = 2, childRender}: WaterfallProps) {\n\n    let refFlag: Array<HTMLDivElement | any> = [];\n    \n    const len = data.length;\n    const initColData = Array(col).fill('col').map(() => []) as Array<Array<any>>;\n    const [colData, setCol] = useState(initColData);\n\n    const waterfallControl = new WaterfallControl();\n    waterfallControl.setData(data);\n    waterfallControl.setCol(col);\n    \n    const [dataManager] = useState(waterfallControl);\n    const [curIdx, setCurIdx] = useState(0);\n\n    useEffect(() => {\n        const colWidth = refFlag[0].offsetWidth;\n        // 通过列的宽度去折合计算图片的宽高\n        waterfallControl.setColWidth(colWidth);\n    }, [])\n\n    useEffect(() => {\n        if (curIdx < len - 1) {\n            dataManager.pushDataToLowCol(refFlag);\n            setCol(dataManager.getColData());\n            setCurIdx(dataManager.getCurIdx());\n        }\n    }, [curIdx])\n\n    return <div className=\"zui-waterfall zui-clearfix\">\n        {\n            colData.map((val, idx) => <div key={idx}\n                className=\"zui-waterfall-col\"\n                style={{\n                    width: 100/col + '%'\n                }}>\n                {\n                    val.map((sub, subIdx) => <div key={`${idx}-${subIdx}`}\n                        className=\"zui-waterfall-item\">\n                        <img\n                            style={{\n                                width: sub.width + 'px',\n                                height: sub.height + 'px'\n                            }}\n                            className=\"zui-waterfall-img\"\n                            src={sub.url}\n                        />\n                        {/* 子模块可以自定义 */}\n                        { \n                            typeof childRender === 'function' ?\n                                childRender(sub) :\n                                <div>{sub.txt}</div>\n                        }\n                    </div>)\n                }\n                <div ref={ele => refFlag[idx] = ele}></div>\n            </div>)\n        }\n    </div>\n}\n\nexport default Waterfall;\n","import React from 'react';\nimport Waterfall from '../../../views/Waterfall'\n\nimport data from './data.js'\n\n\nfunction SubBody(props) {\n    return <div>\n        <p className=\"zui-waterfall-txt\">{props.txt}</p>\n    </div>\n}\n\nexport default () => {\n\n    function getSize(url) {\n        const sizeReg = url.match(/__(\\d{1,8})\\*(\\d{1,8})./)\n        return {\n            width: Number(sizeReg[1]),\n            height: Number(sizeReg[2]),\n        }\n    }\n\n    const formatData = data.map(val => {\n        const size = getSize(val.url)\n        return Object.assign({}, val, size)\n    })\n\n    return <div>\n        <Waterfall data={formatData} col={3} childRender={SubBody}></Waterfall>\n    </div>\n}","export default [\n    {\n        url: `https://zhongmeizhi.github.io/static/test-2/20__78*241.jpg`,\n        txt: `这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/19__162*220.jpg`,\n        txt: `这里是文本。这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/18__130*170.jpg`,\n        txt: `这里是文本。这里是文本。这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/17__160*200.jpg`,\n        txt: ``,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/16__188*200.jpg`,\n        txt: `这里是文本。这里是文本。这里是文本。这里是文本。这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/15__200*200.jpg`,\n        txt: `瀑布流`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/14__200*189.jpg`,\n        txt: `这里是文本。这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/13__181*120.jpg`,\n        txt: ``,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/12__208*130.jpg`,\n        txt: `瀑布流`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/11__150*113.jpg`,\n        txt: ``,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/10__220*165.jpg`,\n        txt: `这里是文本。这里是文本。这里是文本。这里是文本。这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/9__150*150.jpg`,\n        txt: ``,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/8__200*200.jpg`,\n        txt: `瀑布流`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/7__200*151.jpg`,\n        txt: `这里是文本。这里是文本。这里是文本。这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/6__200*200.jpg`,\n        txt: `这里是文本。这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/5__224*174.jpg`,\n        txt: ``,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/4__200*200.jpg`,\n        txt: ``,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/3__200*200.jpg`,\n        txt: ``,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/2__200*200.jpg`,\n        txt: `这里是文本。这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/1__200*200.jpg`,\n        txt: `这里是文本。这里是文本。这里是文本。`,\n    }, {\n        url: `https://zhongmeizhi.github.io/static/test-2/0__208*130.jpg`,\n        txt: `瀑布流`,\n    }\n]","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}","export default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}","export default function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}"],"sourceRoot":""}