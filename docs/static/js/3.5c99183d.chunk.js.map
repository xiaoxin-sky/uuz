{"version":3,"sources":["../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","controller/waterfall.ts","views/Waterfall.tsx","site/pages/waterfall/index.js","../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/@babel/runtime/helpers/esm/createClass.js"],"names":["_toConsumableArray","arr","Array","isArray","i","arr2","length","iter","Symbol","iterator","Object","prototype","toString","call","from","TypeError","WaterfallControl","data","colData","col","curIdx","this","num","slice","map","val","elements","heightList","ele","offsetTop","miniHeight","Math","min","indexOf","targetIdx","_findLowCol","addCurIdx","push","Waterfall","childRender","linkName","refFlag","len","initColData","fill","useState","setCol","waterfallControl","setData","dataManager","setCurIdx","useEffect","setFirstRowData","getColData","pushDataToLowCol","dataIdx","getCurIdx","imgReady","className","idx","key","style","width","sub","subIdx","src","alt","ref","url","name","desc","SubBody","props","_classCallCheck","instance","Constructor","_defineProperties","target","descriptor","enumerable","configurable","writable","defineProperty","_createClass","protoProps","staticProps"],"mappings":"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","file":"static/js/3.5c99183d.chunk.js","sourcesContent":["import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}","export default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}","export default function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}","\nclass WaterfallControl {\n\n    data: Array<any>;\n    // len: number;\n    colData: Array<Array<any>>;\n    col: number;\n    curIdx: number;\n\n    constructor() {\n        this.data = [];\n        // this.len = 0;\n        this.colData = [];\n        this.col = 0;\n        this.curIdx = 0;\n    }\n\n    getColData() {\n        return this.colData;\n    }\n\n    getCurIdx(): number {\n        return this.curIdx;\n    }\n\n    setCol(col: number) {\n        this.col = col;\n    }\n\n    setData(data: Array<any>) {\n        this.data = data;\n        // this.len = data.length;\n    }\n    \n    addCurIdx(num = 1) {\n        this.curIdx += num; \n    }\n\n    setFirstRowData() {\n        this.colData = this.data.slice(0, this.col).map(val => [val]);\n        if (this.colData.length) {\n            this.curIdx = this.colData.length - 1;\n        }\n    }\n\n    _findLowCol(elements: Array<HTMLDivElement>) {\n        const heightList = elements.map(ele => ele.offsetTop);\n        const miniHeight = Math.min(...heightList);\n        const targetIdx = heightList.indexOf(miniHeight);\n        return targetIdx;\n    }\n\n    pushDataToLowCol(elements: Array<HTMLDivElement>) {\n        const targetIdx = this._findLowCol(elements);\n        this.addCurIdx();\n        this.colData[targetIdx].push(this.data[this.curIdx]);\n    }\n}\n\nexport default WaterfallControl;","import React, { useState, useEffect } from 'react';\n\nimport { imgReady } from '../utils/base';\nimport WaterfallControl from '../controller/waterfall';\n\ninterface WaterfallProps {\n    data: Array<any>,\n    col: number,\n    childRender: any,\n    linkName: string\n}\n/* \n    瀑布流：图片需要从cdn下载，所以不能实时获取到图片宽高\n\n    已知获取图片宽高的方法\n    1. 限制图片宽高\n    2. 已知图片宽高\n    3. 等待图片加载获取宽高\n*/\nfunction Waterfall({ data, col = 2, childRender, linkName = 'url'}: WaterfallProps) {\n\n    let refFlag: Array<HTMLDivElement | any> = [];\n    \n    const len = data.length;\n    const initColData = Array(col).fill('col').map(() => []) as Array<Array<any>>;\n    const [colData, setCol] = useState(initColData);\n\n    const waterfallControl = new WaterfallControl();\n    waterfallControl.setData(data);\n    waterfallControl.setCol(col);\n    \n    const [dataManager, setManager] = useState(waterfallControl);\n    const [curIdx, setCurIdx] = useState(0);\n\n    useEffect(() => {\n        if (curIdx < len - 1) {\n            if (curIdx < col - 1) {\n                dataManager.setFirstRowData()\n                setCol(dataManager.getColData());\n            } else {\n                dataManager.pushDataToLowCol(refFlag);\n                setCol(dataManager.getColData());\n            }\n            const dataIdx = dataManager.getCurIdx();\n            imgReady(data[dataIdx][linkName], () => {\n                setCurIdx(dataIdx);\n            })\n        }\n    }, [curIdx])\n\n    return <div className=\"zui-waterfall zui-clearfix\">\n        {\n            colData.map((val, idx) => <div key={idx}\n                className=\"zui-waterfall-col\"\n                style={{\n                    width: 100/col + '%'\n                }}>\n                {\n                    val.map((sub, subIdx) => <div key={`${idx}-${subIdx}`}\n                        className=\"zui-waterfall-item\">\n                        {/* 子模块可以自定义 */}\n                        { \n                            typeof childRender === 'function' ?\n                                childRender(sub) :\n                                <img\n                                    className=\"zui-waterfall-img\"\n                                    src={sub[linkName]}\n                                    alt=\"瀑布流\"\n                                />\n                        }\n                    </div>)\n                }\n                <div ref={ele => refFlag[idx] = ele}></div>\n            </div>)\n        }\n    </div>\n}\n\nexport default Waterfall;\n","import React from 'react';\nimport Waterfall from '../../../views/Waterfall'\n\nconst data = Array(21).fill('data').map((val, idx) => {\n    return {\n        url: `https://zhongmeizhi.github.io/static/test/${20-idx}.jpg`,\n        name: `瀑布流`,\n        desc: `${idx}`\n    }\n})\n\n\nfunction SubBody(props) {\n    return <div>\n        <img className=\"test-waterfall-img\" alt=\"瀑布流\"\n            src={props.url}></img>\n        <p className=\"zui-waterfall-txt\">{props.name}</p>\n        <p className=\"zui-waterfall-txt\">{props.desc}</p>\n    </div>\n}\n\nexport default () => {\n    return <div>\n        <Waterfall data={data} col={3} childRender={SubBody}></Waterfall>\n    </div>\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}"],"sourceRoot":""}